#!/bin/zsh

LOG_FOLDER=/var/log

FULLY_QUALIFIED_NAME=${1}

LOG_MESSAGE="${2}"

CURRENT_LOG_FOLDER="${LOG_FOLDER}/${FULLY_QUALIFIED_NAME}"

echo CURRENT_LOG_FOLDER=$CURRENT_LOG_FOLDER
CURRENT_APPNAME=$(echo ${FULLY_QUALIFIED_NAME} | rev | cut -d '.' -f1 | rev)

CURRENT_LOG_FILE="${CURRENT_LOG_FOLDER}/${CURRENT_APPNAME}.log"

sudo mkdir -p "${CURRENT_LOG_FOLDER}"
sudo touch "${CURRENT_LOG_FILE}"

sudo echo "$(date +%s•%c) • ${FULLY_QUALIFIED_NAME} • ${LOG_MESSAGE}" >> "${CURRENT_LOG_FILE}"

COUNT_LOG_LINES=$(cat "${CURRENT_LOG_FILE}" | wc -l)
COUNT_LOG_FILES=0
[[ -f "${CURRENT_LOG_FILE}.*"  ]] && COUNT_LOG_FILES=$(ls -1 "${CURRENT_LOG_FILE}.*" | wc -l)
echo COUNT_LOG_FILES=$COUNT_LOG_FILES
[[ ${COUNT_LOG_LINES} -gt 350 ]] && { mv ${CURRENT_LOG_FILE} }
